<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/global.css}"/>
    <!-- 引入editormd的css文件 -->
    <link rel="stylesheet" type="text/css" th:href="@{/lib/editormd/css/editormd.css}">
    <!--    <link rel="stylesheet" th:href="@{/lib/editormd/css/editormd.preview.css}">-->
    <title>新增帖子</title>
</head>
<body>

<!-- 头部 -->
<header class="bg-dark sticky-top" th:replace="index::header">
    <div class="container">
        <!-- 导航 -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <!-- logo -->
            <a class="navbar-brand" href="#"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- 功能 -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item ml-3 btn-group-vertical">
                        <a class="nav-link" href="../index.html">首页</a>
                    </li>
                    <li class="nav-item ml-3 btn-group-vertical">
                        <a class="nav-link position-relative" href="letter.html">消息<span
                                class="badge badge-danger">12</span></a>
                    </li>
                    <li class="nav-item ml-3 btn-group-vertical">
                        <a class="nav-link" href="register.html">注册</a>
                    </li>
                    <li class="nav-item ml-3 btn-group-vertical">
                        <a class="nav-link" href="login.html">登录</a>
                    </li>
                    <li class="nav-item ml-3 btn-group-vertical dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img src="http://images.nowcoder.com/head/1t.png" class="rounded-circle"
                                 style="width:30px;"/>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item text-center" href="profile.html">个人主页</a>
                            <a class="dropdown-item text-center" href="setting.html">账号设置</a>
                            <a class="dropdown-item text-center" href="login.html">退出登录</a>
                            <div class="dropdown-divider"></div>
                            <span class="dropdown-item text-center text-secondary">nowcoder</span>
                        </div>
                    </li>
                </ul>
                <!-- 搜索 -->
                <form class="form-inline my-2 my-lg-0" action="search.html">
                    <input class="form-control mr-sm-2" type="search" aria-label="Search"/>
                    <button class="btn btn-outline-light my-2 my-sm-0" type="submit">搜索</button>
                </form>
            </div>
        </nav>
    </div>
</header>

<!-- 中间内容 -->

<div class="m-container m-padded-tb-big">
    <div class="ui container">
        <form id="discusspost-form" th:action="@{/discuss/add}" method="post" class="ui form">
            <input type="hidden" name="id">

            <div class="required field">
                <div class="ui left labeled input">
                    <input type="text" name="title" id="title" placeholder="标题，长度不能超过100个字符！">
                </div>
            </div>

            <div class="two fields">

                <div class="required field">
                    <div class="ui left labeled action input">
                        <label class="ui compact teal basic label">版块</label>
                        <div class="ui fluid selection dropdown">
                            <input type="hidden" name="sectionId" id="sectionId">
                            <i class="dropdown icon"></i>
                            <div class="default text">版块</div>
                            <div class="menu">
                                <div th:each="section:${sections}" class="item" th:data-value="${section.id}"
                                     th:text="${section.name}">摸鱼方法
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="required field">
                <div id="my-editormd" style="z-index: 1 !important;">
                    <!--                    <textarea name="content" id="content" placeholder="帖子内容..." maxlength="300"></textarea>-->
                    <!--                    <input id="content" name="content"/>-->
                    <textarea id="my-editormd-markdown-doc" name="my-editormd-markdown-doc"
                              style="display:none;"></textarea>
                    <!-- 注意：name属性的值-->
                    <textarea id="my-editormd-html-code" name="my-editormd-html-code" style="display:none;"></textarea>
                </div>
            </div>

            <div class="inline fields">

                <div class="field">
                    <div class="ui checkbox">
                        <input type="checkbox" id="commentabled" name="commentabled" class="hidden">
                        <label for="commentabled">能否评论</label>
                    </div>
                </div>

            </div>

            <div class="ui error message"></div>

            <div class="ui right aligned container">
                <button type="button" class="ui button" onclick="window.history.go(-1)">返回</button>
                <button type="button" id="publish-btn" class="ui teal button">发布</button>
            </div>

        </form>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"></script>
<script th:src="@{/lib/editormd/editormd.js}" type="text/javascript"></script>
<script>

    //初始化Markdown编辑器
    var contentEditor;
    $(function () {
        contentEditor = editormd("my-editormd", {
            placeholder: '本编辑器支持Markdown编辑，左边编写，右边预览，希望你能发表友善的言论！',
            width: "100%",
            height: 640,
            syncScrolling: "single",
//        path    : "../static/lib/editormd/lib/"
            path: "../lib/editormd/lib/",

            //这个配置，方便post提交表单，将生成的HTML存放到某个TextArea中，方便在后端获取生成的HTML
            saveHTMLToTextarea: true,

            emoji: true,//emoji表情，默认关闭

            /**上传图片相关配置如下*/
            imageUpload: true,
            imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL: "/community/discuss/upload",//注意你后端的上传图片服务地址

        });
    });

    $('#publish-btn').click(function () {

        $('#discusspost-form').submit();

    });

    $('.ui.dropdown').dropdown({
        on: 'hover'
    });

    $('.ui.form').form({    //表单元素非空验证
        fields: {
            title: {
                identifier: 'title',
                rules: [{
                    type: 'empty',
                    prompt: '标题：请输入帖子标题'
                }]
            },
            content: {
                identifier: 'content',
                rules: [{
                    type: 'empty',
                    prompt: '标题：请输入帖子内容'
                }]
            },
            sectionId: {
                identifier: 'sectionId',
                rules: [{
                    type: 'empty',
                    prompt: '标题：请选择帖子的版块'
                }]
            }
        }
    });

</script>
</body>
</html>